<div align="center">

# üîê VK ID –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è Discourse

[![Discourse](https://img.shields.io/badge/Discourse-2.7.0+-blue.svg?logo=discourse&logoColor=white)](https://www.discourse.org/)
[![Ruby](https://img.shields.io/badge/Ruby-2.7+-red.svg?logo=ruby&logoColor=white)](https://www.ruby-lang.org/)
[![JavaScript](https://img.shields.io/badge/JavaScript-ES6+-yellow.svg?logo=javascript&logoColor=white)](https://developer.mozilla.org/ru/docs/Web/JavaScript)
[![OAuth 2.1](https://img.shields.io/badge/OAuth-2.1-green.svg)](https://oauth.net/2.1/)
[![–õ–∏—Ü–µ–Ω–∑–∏—è](https://img.shields.io/badge/–õ–∏—Ü–µ–Ω–∑–∏—è-MIT-blue.svg)](LICENSE)

### üåç Languages / –Ø–∑—ã–∫–∏

[![English](https://img.shields.io/badge/üá¨üáß_English-README-blue?style=for-the-badge)](README.md)
[![–†—É—Å—Å–∫–∏–π](https://img.shields.io/badge/üá∑üá∫_–†—É—Å—Å–∫–∏–π-README-red?style=for-the-badge)](README_RU.md)

---

**OAuth 2.1 –ø–ª–∞–≥–∏–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π VK ID, OK.ru –∏ Mail.ru**

[–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏) ‚Ä¢ [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞) ‚Ä¢ [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#Ô∏è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞) ‚Ä¢ [–ú–∏–≥—Ä–∞—Ü–∏—è](#-–º–∏–≥—Ä–∞—Ü–∏—è-—Å–æ-—Å—Ç–∞—Ä–æ–≥–æ-–ø–ª–∞–≥–∏–Ω–∞) ‚Ä¢ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

</div>

---

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –≤–µ—Ä—Å–∏–∏ 2.0

**–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è VK ID (id.vk.ru)**:

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| üîí OAuth 2.1 —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º PKCE | ‚úÖ |
| üÜî –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã VK ID (`id.vk.ru`) | ‚úÖ |
| üé® OneTap –≤–∏–¥–∂–µ—Ç (VK ID SDK) | ‚úÖ |
| üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ |
| üåê –ú—É–ª—å—Ç–∏-–ø—Ä–æ–≤–∞–π–¥–µ—Ä (VK/OK/Mail.ru) | ‚úÖ |
| üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω | ‚úÖ |
| üåô –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã | ‚úÖ |
| üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (~150 —Ç–µ—Å—Ç–æ–≤) | ‚úÖ |
| üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (EN/RU) | ‚úÖ |

---

## ‚ö° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

<table>
<tr>
<td width="50%">

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **OAuth 2.1** —Å PKCE
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∫–æ–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email —á–µ—Ä–µ–∑ `id_token`
- –¢–æ–∫–µ–Ω—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

</td>
<td width="50%">

### üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç
- **OneTap –≤–∏–¥–∂–µ—Ç** –≤ –æ–∫–Ω–µ –≤—Ö–æ–¥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
  - üîµ VK ID
  - üü† OK.ru
  - üîµ Mail.ru
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
- –ê–≤—Ç–æ-–º–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

</td>
</tr>
<tr>
<td width="50%">

### üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è OmniAuth —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- Rake –∑–∞–¥–∞—á–∏ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
- –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ì–æ—Ç–æ–≤ –∫ TypeScript

</td>
<td width="50%">

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–ø—Ä–∞–≤–∫–∞ –ø–æ API
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

</td>
</tr>
</table>

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è |
|-----------|--------|
| ![Discourse](https://img.shields.io/badge/Discourse-2.7.0+-blue?logo=discourse) | 2.7.0 –∏–ª–∏ –≤—ã—à–µ |
| ![Ruby](https://img.shields.io/badge/Ruby-2.7+-red?logo=ruby) | 2.7+ |
| ![VK ID](https://img.shields.io/badge/VK_ID-App-blue?logo=vk) | –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ [id.vk.ru](https://id.vk.ru/about/business/go) |
| ![VK ID](https://img.shields.io/badge/VK_ID-App-red?logo=vk) | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ–º–æ –Ω–∞ [id.vk.ru](https://id.vk.ru/about/business/demo/) |
---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞

–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–ª–∞–≥–∏–Ω–∞](https://meta.discourse.org/t/install-a-plugin/19157):

```bash
cd /var/discourse
nano containers/app.yml
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `hooks.after_code`:
```yaml
- git clone https://github.com/kaktaknet/discourse-vkid-oauth.git
```
```bash
git@github.com:kaktaknet/discourse-vkid-oauth.git
```

### –®–∞–≥ 2: –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
cd /var/discourse
./launcher rebuild app
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è VK ID

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **[–ö–æ–Ω—Å–æ–ª—å VK ID](https://id.vk.ru/about/business/go)**
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É **"–í–µ–±-—Å–∞–π—Ç"**

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth

**Redirect URI:**
```
https://–≤–∞—à-—Å–∞–π—Ç-discourse.com/auth/vkid/callback
```

**–°–∫–æ—É–ø—ã:**
- ‚úÖ `vkid.personal_info` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- ‚úÖ `email` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ `phone` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**PKCE:** ‚úÖ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Discourse

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤: **–ê–¥–º–∏–Ω ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í—Ö–æ–¥**

| –ù–∞—Å—Ç—Ä–æ–π–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|----------|
| `vkid_enabled` | ‚úÖ | –í–∫–ª—é—á–∏—Ç—å VK ID –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é |
| `vkid_client_id` | `123456` | ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ VK ID |
| `vkid_client_secret` | `‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ VK ID |
| `vkid_scope` | `vkid.personal_info email phone` | OAuth —Å–∫–æ—É–ø—ã |
| `vkid_widget_enabled` | ‚úÖ | –í–∫–ª—é—á–∏—Ç—å OneTap –≤–∏–¥–∂–µ—Ç |
| `vkid_widget_providers` | `vkid,ok_ru,mail_ru` | –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≤–∏–¥–∂–µ—Ç–∞ |

---

## üé® OneTap –≤–∏–¥–∂–µ—Ç

<div align="center">

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –¶–≤–µ—Ç | –ò–∫–æ–Ω–∫–∞ |
|-----------|------|--------|
| VK ID | <svg width="15" height="15"><rect width="15" height="15" fill="#0077ff"/></svg> `#0077ff` | üîµ |
| OK.ru | <svg width="15" height="15"><rect width="15" height="15" fill="#ee8208"/></svg> `#ee8208` | üü† |
| Mail.ru | <svg width="15" height="15"><rect width="15" height="15" fill="#005ff9"/></svg> `#005ff9` | üîµ |

</div>

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (~50KB gzip)
- üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- üåô –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã
- üéØ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –æ–¥–∏–Ω –∫–ª–∏–∫
- üîÑ –ë–µ—Å—à–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è ‚ú®

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É—é—Ç** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ VK ID
    ‚Üì
–ü–ª–∞–≥–∏–Ω –Ω–∞—Ö–æ–¥–∏—Ç —Å—Ç–∞—Ä—ã–π –∞–∫–∫–∞—É–Ω—Ç 'vkontakte'
    ‚Üì
–û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä 'vkid'
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚úÖ
```

**–ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤—Ä—É—á–Ω—É—é –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!**

### –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å—Ä–∞–∑—É:

```bash
cd /var/discourse
./launcher enter app
rake vkid:migrate_users
```

**–°–º.:** [MIGRATION_GUIDE_RU.md](MIGRATION_GUIDE_RU.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

<div align="center">

### OAuth 2.1 –ø—Ä–æ—Ü–µ—Å—Å —Å PKCE

```mermaid
graph LR
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|–ö–ª–∏–∫ –í–æ–π—Ç–∏| B[VK ID –í–∏–¥–∂–µ—Ç]
    B -->|–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PKCE| C[VK ID –°–µ—Ä–≤–µ—Ä]
    C -->|–ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏| D[Discourse Callback]
    D -->|–û–±–º–µ–Ω + –ü—Ä–æ–≤–µ—Ä–∫–∞ PKCE| E[Access Token]
    E -->|–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö| F[–°–æ–∑–¥–∞–Ω–∏–µ/–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ User]
    F -->|–°–µ—Å—Å–∏—è| A
```

</div>

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –£—Ä–æ–≤–µ–Ω—å | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|-----------|
| **Frontend** | ![JavaScript](https://img.shields.io/badge/-JavaScript-yellow?logo=javascript&logoColor=white) VK ID SDK | UI –≤–∏–¥–∂–µ—Ç–∞ |
| **Backend** | ![Ruby](https://img.shields.io/badge/-Ruby-red?logo=ruby&logoColor=white) Custom Strategy | OAuth 2.1 + PKCE |
| **Auth** | ![OAuth](https://img.shields.io/badge/-OAuth_2.1-green) | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π flow |
| **Data** | ![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-blue?logo=postgresql&logoColor=white) | –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
discourse-vk-auth/
‚îú‚îÄ‚îÄ üìÑ plugin.rb                              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ üìÅ lib/
‚îÇ   ‚îú‚îÄ‚îÄ üîê vkid_authenticator.rb             # –û—Å–Ω–æ–≤–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ üîë omniauth/strategies/vkid.rb       # OAuth 2.1 + PKCE
‚îÇ   ‚îî‚îÄ‚îÄ üõ†Ô∏è tasks/vkid_migration.rake         # –£—Ç–∏–ª–∏—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ üìÅ assets/
‚îÇ   ‚îú‚îÄ‚îÄ üé® javascripts/                       # VK ID –≤–∏–¥–∂–µ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ üíÖ stylesheets/                       # –°—Ç–∏–ª–∏ –≤–∏–¥–∂–µ—Ç–∞
‚îú‚îÄ‚îÄ üìÅ config/
‚îÇ   ‚îú‚îÄ‚îÄ ‚öôÔ∏è settings.yml                       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
‚îÇ   ‚îî‚îÄ‚îÄ üåê locales/                           # i18n (en, ru)
‚îú‚îÄ‚îÄ üß™ spec/                                  # –ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ (~150 —Ç–µ—Å—Ç–æ–≤)
‚îú‚îÄ‚îÄ üìñ README.md                              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (English)
‚îú‚îÄ‚îÄ üìñ README_RU.md                           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ üìñ MIGRATION_GUIDE.md                     # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (EN)
‚îî‚îÄ‚îÄ üìñ MIGRATION_GUIDE_RU.md                  # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (RU)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
bundle exec rspec
```

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è PKCE
- ‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å username
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ ID Token
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OAuth flow

**–í—Å–µ–≥–æ:** ~150 —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

<details>
<summary><b>‚ùå "invalid_request: code_verifier is missing"</b></summary>

**–ü—Ä–∏—á–∏–Ω–∞:** PKCE –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–ª–∏ –æ—Ç–∫–ª—é—á—ë–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–ª–∞–≥–∏–Ω v2.0+. PKCE –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π.
</details>

<details>
<summary><b>‚ùå "Email –Ω–µ –≤–æ–∑–≤—Ä–∞—â—ë–Ω –æ—Ç VK ID"</b></summary>

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∫–æ—É–ø email –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª email.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `vkid_scope` –≤–∫–ª—é—á–∞–µ—Ç `email`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ VK ID –≤–∫–ª—é—á–µ–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ email
- –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å email –≤ –∞–∫–∫–∞—É–Ω—Ç–µ VK
</details>

<details>
<summary><b>‚ùå "redirect_uri_mismatch"</b></summary>

**–ü—Ä–∏—á–∏–Ω–∞:** Redirect URI –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è VK.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ redirect URI –≤ –∫–æ–Ω—Å–æ–ª–∏ VK ID:
```
https://–≤–∞—à-—Å–∞–π—Ç.com/auth/vkid/callback
```
</details>

<details>
<summary><b>‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è</b></summary>

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
1. `vkid_enabled` = true
2. `vkid_widget_enabled` = true
3. `vkid_client_id` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
4. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

**–û—Ç–ª–∞–¥–∫–∞:**
```javascript
console.log(window.VKIDSDK); // –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å SDK
console.log(Discourse.SiteSettings.vkid_enabled); // true
```
</details>

**–°–º.:** –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –≤ [README_RU.md](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| üìñ [README.md](README.md) | –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (English) |
| üìñ [README_RU.md](README_RU.md) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–†—É—Å—Å–∫–∏–π) |
| üìñ [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) | –ú–∏–≥—Ä–∞—Ü–∏—è —Å v1.x (EN) |
| üìñ [MIGRATION_GUIDE_RU.md](MIGRATION_GUIDE_RU.md) | –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ (RU) |

---

## üîó API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-----------|
| `https://id.vk.ru/authorize` | OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| `https://id.vk.ru/oauth2/auth` | –û–±–º–µ–Ω —Ç–æ–∫–µ–Ω–∞ |
| `https://id.vk.ru/oauth2/user_info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ |

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–§–æ—Ä—É–º:** [Discourse Meta](https://meta.discourse.org/t/vk-com-login-vkontakte/12987)
- **–ü—Ä–æ–±–ª–µ–º—ã:** [GitHub Issues](https://github.com/kaktaknet/discourse-vk-auth/issues)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK ID:** [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://id.vk.ru/about/business/go/docs/ru/vkid/latest/oauth-vk)
- **–î–ï–ú–û VK ID:** [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è](https://id.vk.ru/about/business/go/demo)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE)

---

## üéâ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –í–µ—Ä—Å–∏—è 2.0.0 (2025)

#### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ OAuth 2.1 —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º PKCE
- ‚úÖ –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è OmniAuth —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VK ID SDK –≤–∏–¥–∂–µ—Ç–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (VK/OK/Mail.ru)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–≤—É—è–∑—ã—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (`id.vk.ru`)
- ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è PKCE (RFC 7636)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ ID Token
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –í–µ—Ä—Å–∏—è 1.x (–£—Å—Ç–∞—Ä–µ–≤—à–∞—è)

- ‚ö†Ô∏è –°—Ç–∞—Ä—ã–π VK OAuth 2.0 (`oauth.vk.com`)
- ‚ö†Ô∏è –ë–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ PKCE
- ‚ö†Ô∏è –ë–æ–ª–µ–µ –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞

---

<div align="center">
[![Stars](https://img.shields.io/github/stars/kaktaknet/discourse-vk-auth?style=social)](https://github.com/kaktaknet/discourse-vk-auth)

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ Discourse**

[‚¨Ü –ù–∞–≤–µ—Ä—Ö](#-vk-id-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–¥–ª—è-discourse)</div>
